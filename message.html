<!DOCTYPE html>
<html lang="vi">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>L·ªùi Nh·∫Øn T√¨nh Y√™u - Love Story</title>
    <!-- Load Authentication Script -->
    <script src="auth.js"></script>
    <style>
      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }

      body {
        font-family: "Arial", sans-serif;
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        min-height: 100vh;
        overflow-x: hidden;
      }

      /* Floating Hearts Animation */
      .floating-hearts {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        pointer-events: none;
        z-index: 1;
      }

      .heart {
        position: absolute;
        color: rgba(255, 182, 193, 0.6);
        font-size: 20px;
        animation: float 6s infinite ease-in-out;
      }

      @keyframes float {
        0% {
          transform: translateY(100vh) rotate(0deg);
          opacity: 0;
        }
        10% {
          opacity: 1;
        }
        90% {
          opacity: 1;
        }
        100% {
          transform: translateY(-100px) rotate(360deg);
          opacity: 0;
        }
      }

      /* Navigation */
      .nav-menu {
        position: fixed;
        bottom: 0;
        left: 0;
        right: 0;
        background: rgba(255, 255, 255, 0.95);
        backdrop-filter: blur(10px);
        border-radius: 20px 20px 0 0;
        box-shadow: 0 -5px 25px rgba(0, 0, 0, 0.1);
        z-index: 1000;
        padding: 15px 0;
      }

      .nav-links {
        display: flex;
        justify-content: space-around;
        align-items: center;
        list-style: none;
        max-width: 400px;
        margin: 0 auto;
      }

      .nav-links a {
        text-decoration: none;
        color: #667eea;
        font-size: 12px;
        display: flex;
        flex-direction: column;
        align-items: center;
        gap: 5px;
        padding: 10px;
        border-radius: 15px;
        transition: all 0.3s ease;
      }

      .nav-links a:before {
        content: "";
        font-size: 20px;
      }

      .nav-links a[href="index.html"]:before {
        content: "üè†";
      }
      .nav-links a[href="counter.html"]:before {
        content: "‚è∞";
      }
      .nav-links a[href="timeline.html"]:before {
        content: "üìÖ";
      }
      .nav-links a[href="gallery.html"]:before {
        content: "üì∏";
      }
      .nav-links a[href="message.html"]:before {
        content: "üíå";
      }

      .nav-links a:hover,
      .nav-links a.active {
        background: rgba(102, 126, 234, 0.2);
        transform: translateY(-2px);
      }

      /* Main Container */
      .container {
        padding: 20px;
        padding-bottom: 100px;
        max-width: 100%;
        margin: 0 auto;
      }

      /* Header */
      .header {
        text-align: center;
        margin-bottom: 30px;
        padding: 30px 20px;
        background: rgba(255, 255, 255, 0.1);
        border-radius: 25px;
        backdrop-filter: blur(10px);
        box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
      }

      .header h1 {
        font-size: 2.2em;
        color: white;
        margin-bottom: 10px;
        text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.3);
      }

      .header .subtitle {
        color: rgba(255, 255, 255, 0.9);
        font-size: 1em;
        font-weight: 300;
      }

      /* Love Letters */
      .love-letter {
        background: rgba(255, 255, 255, 0.95);
        border-radius: 25px;
        padding: 30px 25px;
        margin-bottom: 30px;
        box-shadow: 0 10px 40px rgba(0, 0, 0, 0.1);
        position: relative;
        overflow: hidden;
        opacity: 0;
        transform: translateY(30px);
        animation: slideInUp 0.6s ease forwards;
      }

      .love-letter:nth-child(2) {
        animation-delay: 0.1s;
      }
      .love-letter:nth-child(3) {
        animation-delay: 0.2s;
      }
      .love-letter:nth-child(4) {
        animation-delay: 0.3s;
      }
      .love-letter:nth-child(5) {
        animation-delay: 0.4s;
      }
      .love-letter:nth-child(6) {
        animation-delay: 0.5s;
      }

      @keyframes slideInUp {
        to {
          opacity: 1;
          transform: translateY(0);
        }
      }

      .love-letter::before {
        content: "";
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        height: 4px;
        background: linear-gradient(135deg, #667eea, #764ba2);
      }

      .letter-header {
        display: flex;
        align-items: center;
        gap: 15px;
        margin-bottom: 20px;
      }

      .letter-icon {
        font-size: 2.5em;
        min-width: 60px;
      }

      .letter-info h3 {
        color: #333;
        font-size: 1.3em;
        margin-bottom: 5px;
        font-weight: 600;
      }

      .letter-date {
        color: #667eea;
        font-size: 0.9em;
        font-weight: 500;
      }

      .letter-content {
        color: #555;
        line-height: 1.7;
        font-size: 1.05em;
        text-align: justify;
        margin-bottom: 20px;
      }

      .letter-signature {
        text-align: right;
        color: #667eea;
        font-style: italic;
        font-weight: 600;
        font-size: 1.1em;
      }

      /* Special Letters */
      .special-letter {
        background: linear-gradient(
          135deg,
          rgba(255, 182, 193, 0.9),
          rgba(255, 218, 185, 0.9)
        );
        border: 2px solid rgba(255, 182, 193, 0.5);
      }

      .special-letter::before {
        background: linear-gradient(135deg, #ff6b9d, #c44569);
      }

      /* Message Form */
      .message-form {
        background: rgba(255, 255, 255, 0.95);
        border-radius: 25px;
        padding: 30px 25px;
        margin-bottom: 30px;
        box-shadow: 0 10px 40px rgba(0, 0, 0, 0.1);
      }

      .form-title {
        color: #333;
        font-size: 1.4em;
        margin-bottom: 20px;
        text-align: center;
        font-weight: 600;
      }

      .form-group {
        margin-bottom: 20px;
      }

      .form-group label {
        display: block;
        color: #555;
        margin-bottom: 8px;
        font-weight: 500;
      }

      .form-group input,
      .form-group textarea,
      .form-group select {
        width: 100%;
        padding: 15px;
        border: 2px solid #e0e0e0;
        border-radius: 15px;
        font-size: 1em;
        transition: border-color 0.3s ease;
        font-family: inherit;
      }

      .form-group input:focus,
      .form-group textarea:focus,
      .form-group select:focus {
        outline: none;
        border-color: #667eea;
        box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
      }

      .form-group textarea {
        resize: vertical;
        min-height: 120px;
      }

      .form-row {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 15px;
      }

      .submit-btn {
        background: linear-gradient(135deg, #667eea, #764ba2);
        color: white;
        border: none;
        padding: 15px 30px;
        border-radius: 25px;
        font-size: 1.1em;
        font-weight: 600;
        cursor: pointer;
        transition: all 0.3s ease;
        width: 100%;
        box-shadow: 0 5px 15px rgba(102, 126, 234, 0.3);
        position: relative;
      }

      .submit-btn:hover:not(:disabled) {
        transform: translateY(-2px);
        box-shadow: 0 8px 25px rgba(102, 126, 234, 0.4);
      }

      .submit-btn:disabled {
        opacity: 0.6;
        cursor: not-allowed;
      }

      .loading {
        display: none;
        position: absolute;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
      }

      .loading.active {
        display: block;
      }

      .loading::after {
        content: "";
        width: 20px;
        height: 20px;
        border: 2px solid transparent;
        border-top: 2px solid white;
        border-radius: 50%;
        animation: spin 1s linear infinite;
      }

      @keyframes spin {
        to {
          transform: rotate(360deg);
        }
      }

      /* Success/Error Messages */
      .message-status {
        padding: 15px;
        border-radius: 15px;
        margin-bottom: 20px;
        text-align: center;
        font-weight: 600;
        display: none;
      }

      .message-status.success {
        background: linear-gradient(135deg, #4caf50, #45a049);
        color: white;
      }

      .message-status.error {
        background: linear-gradient(135deg, #f44336, #da190b);
        color: white;
      }

      /* Quote Section */
      .quote-section {
        background: rgba(255, 255, 255, 0.95);
        border-radius: 25px;
        padding: 40px 25px;
        margin-bottom: 30px;
        box-shadow: 0 10px 40px rgba(0, 0, 0, 0.1);
        text-align: center;
      }

      .quote-text {
        color: #333;
        font-size: 1.3em;
        line-height: 1.6;
        font-style: italic;
        margin-bottom: 20px;
        position: relative;
      }

      .quote-text::before,
      .quote-text::after {
        content: '"';
        font-size: 2em;
        color: #667eea;
        font-weight: bold;
      }

      .quote-author {
        color: #667eea;
        font-size: 1.1em;
        font-weight: 600;
      }

      /* Memories Grid */
      .memories-grid {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 20px;
        margin-bottom: 30px;
      }

      .memory-card {
        background: rgba(255, 255, 255, 0.95);
        border-radius: 20px;
        padding: 20px;
        text-align: center;
        box-shadow: 0 8px 25px rgba(0, 0, 0, 0.1);
        transition: transform 0.3s ease;
      }

      .memory-card:hover {
        transform: translateY(-5px);
      }

      .memory-icon {
        font-size: 2.5em;
        margin-bottom: 15px;
      }

      .memory-title {
        color: #333;
        font-size: 1.1em;
        font-weight: 600;
        margin-bottom: 10px;
      }

      .memory-text {
        color: #666;
        font-size: 0.9em;
        line-height: 1.5;
      }

      .char-counter {
        text-align: right;
        font-size: 0.8em;
        color: #999;
        margin-top: 5px;
      }

      /* Download Button */
      .download-btn {
        background: linear-gradient(135deg, #28a745, #20c997);
        color: white;
        border: none;
        padding: 10px 20px;
        border-radius: 20px;
        font-size: 0.9em;
        font-weight: 600;
        cursor: pointer;
        transition: all 0.3s ease;
        margin-top: 20px;
        display: inline-flex;
        align-items: center;
        gap: 8px;
      }

      .download-btn:hover {
        transform: translateY(-2px);
        box-shadow: 0 5px 15px rgba(40, 167, 69, 0.3);
      }

      .download-btn:before {
        content: "üì•";
        font-size: 1.2em;
      }

      @media (max-width: 768px) {
        .letter-header {
          flex-direction: column;
          text-align: center;
        }

        .memories-grid {
          grid-template-columns: 1fr;
        }

        .form-row {
          grid-template-columns: 1fr;
        }
      }

      @media (max-width: 480px) {
        .letter-content {
          font-size: 1em;
        }

        .quote-text {
          font-size: 1.1em;
        }
      }
    </style>
  </head>
  <body>
    <div class="floating-hearts" id="heartsContainer"></div>

    <!-- Navigation Menu -->
    <nav class="nav-menu">
      <ul class="nav-links">
        <li><a href="index.html">Trang ch·ªß</a></li>
        <li><a href="counter.html">Th·ªùi gian</a></li>
        <li><a href="timeline.html">K·ª∑ ni·ªám</a></li>
        <li><a href="gallery.html">·∫¢nh</a></li>
        <li><a href="message.html" class="active">L·ªùi nh·∫Øn</a></li>
      </ul>
    </nav>

    <div class="container">
      <header class="header">
        <h1>üíå Th∆∞ T√¨nh Y√™u üíå</h1>
        <p class="subtitle">Ghi l·∫°i nh·ªØng l·ªùi y√™u th∆∞∆°ng ƒë·∫πp nh·∫•t</p>
      </header>

      <!-- Main Love Letter -->
      <div class="love-letter special-letter">
        <div class="letter-header">
          <div class="letter-icon">üíï</div>
          <div class="letter-info">
            <h3>G·ª≠i em - ng∆∞·ªùi anh y√™u nh·∫•t</h3>
            <div class="letter-date">M√£i m√£i v√† b·∫•t t·∫≠n</div>
          </div>
        </div>
        <div class="letter-content">
          Em y√™u, t·ª´ ng√†y ƒë·∫ßu ti√™n anh g·∫∑p em, cu·ªôc ƒë·ªùi anh ƒë√£ ho√†n to√†n thay
          ƒë·ªïi. Em nh∆∞ m·ªôt tia n·∫Øng ·∫•m √°p chi·∫øu s√°ng nh·ªØng ng√†y t·ªëi tƒÉm c·ªßa anh.
          N·ª• c∆∞·ªùi c·ªßa em c√≥ ma l·ª±c khi·∫øn anh qu√™n ƒëi m·ªçi bu·ªìn phi·ªÅn, √°nh m·∫Øt em
          nh∆∞ ch·ª©a ƒë·ª±ng c·∫£ v≈© tr·ª• sao tr·ªùi. Anh kh√¥ng ph·∫£i l√† ng∆∞·ªùi gi·ªèi l·ªùi n√≥i
          hay vi·∫øt l√°ch, nh∆∞ng v·ªõi em, anh mu·ªën th·ªÉ hi·ªán t·∫•t c·∫£ t√¨nh y√™u trong
          tr√°i tim m√¨nh. Em l√† ni·ªÅm h·∫°nh ph√∫c l·ªõn nh·∫•t c·ªßa anh, l√† ƒë·ªông l·ª±c ƒë·ªÉ
          anh c·ªë g·∫Øng tr·ªü th√†nh phi√™n b·∫£n t·ªët nh·∫•t c·ªßa ch√≠nh m√¨nh. C·∫£m ∆°n em ƒë√£
          ƒë·∫øn b√™n anh, ƒë√£ y√™u anh v√† ƒë√£ cho anh c∆° h·ªôi ƒë∆∞·ª£c y√™u m·ªôt ng∆∞·ªùi tuy·ªát
          v·ªùi nh∆∞ em. Anh h·ª©a s·∫Ω lu√¥n tr√¢n tr·ªçng t√¨nh y√™u n√†y v√† b·∫£o v·ªá em b·∫±ng
          c·∫£ tr√°i tim m√¨nh.
        </div>
        <div class="letter-signature">Y√™u em m√£i m√£i - S∆°n ‚ù§Ô∏è</div>
      </div>

      <!-- Quote Section -->
      <div class="quote-section">
        <div class="quote-text">
          T√¨nh y√™u kh√¥ng ph·∫£i l√† nh√¨n v√†o m·∫Øt nhau, m√† l√† c√πng nhau nh√¨n v·ªÅ m·ªôt
          h∆∞·ªõng. Em l√† ng∆∞·ªùi ƒë·ªìng h√†nh tuy·ªát v·ªùi nh·∫•t trong cu·ªôc h√†nh tr√¨nh n√†y.
        </div>
        <div class="quote-author">- L·ªùi t√¢m s·ª± c·ªßa anh</div>
      </div>

      <!-- Memories Grid -->
      <div class="memories-grid">
        <div class="memory-card">
          <div class="memory-icon">üåü</div>
          <div class="memory-title">L·∫ßn ƒë·∫ßu g·∫∑p em</div>
          <div class="memory-text">
            Kho·∫£nh kh·∫Øc ƒë·ªãnh m·ªánh khi anh bi·∫øt em ch√≠nh l√† ng∆∞·ªùi anh t√¨m ki·∫øm
          </div>
        </div>
        <div class="memory-card">
          <div class="memory-icon">‚òï</div>
          <div class="memory-title">Ly c√† ph√™ ƒë·∫ßu ti√™n</div>
          <div class="memory-text">
            Nh·ªØng c√¢u chuy·ªán kh√¥ng bao gi·ªù k·∫øt th√∫c v√† ti·∫øng c∆∞·ªùi gi√≤n tan
          </div>
        </div>
        <div class="memory-card">
          <div class="memory-icon">üéµ</div>
          <div class="memory-title">B√†i h√°t c·ªßa ƒë√¥i ta</div>
          <div class="memory-text">
            M·ªói l·∫ßn nghe l√† m·ªói l·∫ßn nh·ªõ v·ªÅ nh·ªØng k·ª∑ ni·ªám ƒë·∫πp b√™n em
          </div>
        </div>
        <div class="memory-card">
          <div class="memory-icon">üåô</div>
          <div class="memory-title">ƒê√™m trƒÉng l√£ng m·∫°n</div>
          <div class="memory-text">
            D∆∞·ªõi √°nh trƒÉng, anh ƒë√£ th·ªÅ s·∫Ω y√™u em ƒë·∫øn h·∫øt cu·ªôc ƒë·ªùi
          </div>
        </div>
      </div>

      <!-- Message Form -->
      <div class="message-form">
        <h3 class="form-title">üíå Vi·∫øt l·ªùi nh·∫Øn t√¨nh y√™u üíå</h3>

        <div class="message-status" id="messageStatus"></div>

        <form id="messageForm">
          <div class="form-row">
            <div class="form-group">
              <label for="senderName">T·ª´:</label>
              <input
                type="text"
                id="senderName"
                name="from"
                placeholder="T√™n c·ªßa b·∫°n"
                required
              />
            </div>
            <div class="form-group">
              <label for="recipientName">ƒê·∫øn:</label>
              <input
                type="text"
                id="recipientName"
                name="to"
                placeholder="T√™n ng∆∞·ªùi nh·∫≠n"
                required
              />
            </div>
          </div>

          <div class="form-group">
            <label for="messageSubject">Ti√™u ƒë·ªÅ:</label>
            <select id="messageSubject" name="subject" required>
              <option value="">Ch·ªçn ti√™u ƒë·ªÅ...</option>
              <option value="üíï Anh y√™u em">üíï Anh y√™u em</option>
              <option value="üåπ Nh·ªõ em">üåπ Nh·ªõ em</option>
              <option value="üíñ Tin nh·∫Øn t√¨nh y√™u">üíñ Tin nh·∫Øn t√¨nh y√™u</option>
              <option value="üåü Em l√† √°nh sao c·ªßa anh">
                üåü Em l√† √°nh sao c·ªßa anh
              </option>
              <option value="‚òÄÔ∏è Ch√†o bu·ªïi s√°ng y√™u th∆∞∆°ng">
                ‚òÄÔ∏è Ch√†o bu·ªïi s√°ng y√™u th∆∞∆°ng
              </option>
              <option value="üåô Ch√∫c ng·ªß ngon">üåô Ch√∫c ng·ªß ngon</option>
              <option value="custom">T·ª± vi·∫øt ti√™u ƒë·ªÅ...</option>
            </select>
          </div>

          <div class="form-group" id="customSubjectGroup" style="display: none">
            <label for="customSubject">Ti√™u ƒë·ªÅ t√πy ch·ªânh:</label>
            <input
              type="text"
              id="customSubject"
              name="customSubject"
              placeholder="Vi·∫øt ti√™u ƒë·ªÅ c·ªßa b·∫°n..."
            />
          </div>

          <div class="form-group">
            <label for="messageContent">N·ªôi dung:</label>
            <textarea
              id="messageContent"
              name="message"
              placeholder="Vi·∫øt nh·ªØng l·ªùi y√™u th∆∞∆°ng c·ªßa b·∫°n ·ªü ƒë√¢y..."
              rows="6"
              required
            ></textarea>
            <div class="char-counter" id="messageCounter">0 k√Ω t·ª±</div>
          </div>

          <div class="form-group">
            <label for="messageSignature">Ch·ªØ k√Ω:</label>
            <input
              type="text"
              id="messageSignature"
              name="signature"
              placeholder="V√≠ d·ª•: Y√™u em m√£i m√£i ‚ù§Ô∏è"
            />
          </div>

          <button type="submit" class="submit-btn">
            <span class="btn-text">üíï L∆∞u l·ªùi nh·∫Øn t√¨nh y√™u</span>
            <div class="loading"></div>
          </button>
        </form>

        <button class="download-btn" onclick="downloadAllMessages()">
          T·∫£i xu·ªëng t·∫•t c·∫£ tin nh·∫Øn
        </button>
      </div>

      <!-- Additional Love Letters -->
      <div class="love-letter">
        <div class="letter-header">
          <div class="letter-icon">üåπ</div>
          <div class="letter-info">
            <h3>M·ªói ng√†y b√™n em</h3>
            <div class="letter-date">H√†ng ng√†y</div>
          </div>
        </div>
        <div class="letter-content">
          M·ªói s√°ng th·ª©c d·∫≠y, ƒëi·ªÅu ƒë·∫ßu ti√™n anh nghƒ© ƒë·∫øn l√† em. Em c√≥ kh·ªèe kh√¥ng?
          Em ƒë√£ ƒÉn s√°ng ch∆∞a? Em c√≥ c·∫ßn anh ·ªü b√™n kh√¥ng? Nh·ªØng c√¢u h·ªèi ƒë∆°n gi·∫£n
          nh∆∞ng ch·ª©a ƒë·ª±ng t·∫•t c·∫£ t√¨nh y√™u anh d√†nh cho em. Anh y√™u c√°ch em c∆∞·ªùi
          khi vui, y√™u c√°ch em nghi√™ng ƒë·∫ßu khi suy nghƒ©, y√™u c√°ch em n·∫Øm tay anh
          th·∫≠t ch·∫∑t. Nh·ªØng chi ti·∫øt nh·ªè b√© n√†y l√†m n√™n m·ªôt t√¨nh y√™u to l·ªõn trong
          tim anh.
        </div>
        <div class="letter-signature">Ng∆∞·ªùi y√™u em t·ª´ng gi√¢y ph√∫t üíù</div>
      </div>

      <div class="love-letter">
        <div class="letter-header">
          <div class="letter-icon">üåà</div>
          <div class="letter-info">
            <h3>∆Ø·ªõc m∆° v·ªÅ t∆∞∆°ng lai</h3>
            <div class="letter-date">Ng√†y mai v√† m√£i v·ªÅ sau</div>
          </div>
        </div>
        <div class="letter-content">
          Anh m∆° v·ªÅ m·ªôt ng√¥i nh√† nh·ªè v·ªõi em, n∆°i ch√∫ng ta c√≥ th·ªÉ c√πng nhau n·∫•u
          ƒÉn, c√πng nhau xem phim, c√πng nhau chƒÉm s√≥c khu v∆∞·ªùn nh·ªè. Anh m∆° v·ªÅ
          nh·ªØng ƒë·ª©a con s·∫Ω c√≥ ƒë√¥i m·∫Øt gi·ªëng em v√† n·ª• c∆∞·ªùi gi·ªëng anh. Anh m∆° v·ªÅ
          nh·ªØng chuy·∫øn du l·ªãch xa v·ªõi em, kh√°m ph√° nh·ªØng v√πng ƒë·∫•t m·ªõi, t·∫°o ra
          nh·ªØng k·ª∑ ni·ªám ƒë·∫πp. V√† quan tr·ªçng nh·∫•t, anh m∆° v·ªÅ vi·ªác gi√† ƒëi b√™n em,
          nh√¨n l·∫°i cu·ªôc ƒë·ªùi v√† th·∫•y h·∫°nh ph√∫c v√¨ ƒë√£ c√≥ em.
        </div>
        <div class="letter-signature">Ng∆∞·ªùi c√πng em x√¢y gi·∫•c m∆° üè†</div>
      </div>

      <div class="quote-section">
        <div class="quote-text">
          Y√™u m·ªôt ng∆∞·ªùi kh√¥ng ph·∫£i v√¨ h·ªç ho√†n h·∫£o, m√† v√¨ h·ªç l√†m cho cu·ªôc s·ªëng
          c·ªßa b·∫°n tr·ªü n√™n ho√†n h·∫£o
        </div>
        <div class="quote-author">- S∆°n & Ti√™n Forever üíï</div>
      </div>
    </div>

    <script>
      // Floating Hearts Animation
      function createHeart() {
        const heart = document.createElement("div");
        heart.className = "heart";
        heart.innerHTML = "üíï";
        heart.style.left = Math.random() * 100 + "%";
        heart.style.animationDelay = Math.random() * 3 + "s";
        heart.style.animationDuration = Math.random() * 3 + 3 + "s";
        document.getElementById("heartsContainer").appendChild(heart);

        setTimeout(() => {
          heart.remove();
        }, 6000);
      }

      setInterval(createHeart, 1500);

      // Character counter
      function setupCharCounter() {
        const textarea = document.getElementById("messageContent");
        const counter = document.getElementById("messageCounter");

        textarea.addEventListener("input", function () {
          const length = this.value.length;
          counter.textContent = `${length} k√Ω t·ª±`;

          if (length > 500) {
            counter.style.color = "#ff6b6b";
          } else {
            counter.style.color = "#999";
          }
        });
      }

      setupCharCounter();

      // Handle custom subject
      document
        .getElementById("messageSubject")
        .addEventListener("change", function () {
          const customGroup = document.getElementById("customSubjectGroup");
          if (this.value === "custom") {
            customGroup.style.display = "block";
            document.getElementById("customSubject").required = true;
          } else {
            customGroup.style.display = "none";
            document.getElementById("customSubject").required = false;
          }
        });

      // Show status message
      function showStatus(message, type) {
        const statusDiv = document.getElementById("messageStatus");
        statusDiv.textContent = message;
        statusDiv.className = `message-status ${type}`;
        statusDiv.style.display = "block";

        setTimeout(() => {
          statusDiv.style.display = "none";
        }, 5000);
      }

      // Save message to localStorage and download
      function saveMessage(messageData) {
        // Get existing messages
        let messages = JSON.parse(localStorage.getItem("loveMessages") || "[]");

        // Add new message
        messages.push(messageData);

        // Save to localStorage
        localStorage.setItem("loveMessages", JSON.stringify(messages));

        // Create file content
        const fileContent = formatMessageForFile(messageData);

        // Download individual message
        downloadTextFile(fileContent, `tin-nhan-${Date.now()}thutinh.txt`);

        return messages;
      }

      // Format message for file
      function formatMessageForFile(data) {
        const separator = "‚îÄ".repeat(50);
        return `${separator}
üíå TH∆Ø T√åNH Y√äU üíå
${separator}

T·ª´: ${data.from}
ƒê·∫øn: ${data.to}
Ti√™u ƒë·ªÅ: ${data.subject}
Ng√†y: ${data.date}

${separator}
N·ªòI DUNG:
${separator}

${data.message}

${separator}
${data.signature}
${separator}

ƒê∆∞·ª£c t·∫°o t·ª´ Love Story Website
${new Date().toLocaleString("vi-VN")}
`;
      }

      // Download text file
      function downloadTextFile(content, filename) {
        const blob = new Blob([content], { type: "text/plain;charset=utf-8" });
        const url = window.URL.createObjectURL(blob);
        const a = document.createElement("a");
        a.href = url;
        a.download = filename;
        document.body.appendChild(a);
        a.click();
        document.body.removeChild(a);
        window.URL.revokeObjectURL(url);
      }

      // Download all messages
      function downloadAllMessages() {
        const messages = JSON.parse(
          localStorage.getItem("loveMessages") || "[]"
        );

        if (messages.length === 0) {
          showStatus("‚ùå Ch∆∞a c√≥ tin nh·∫Øn n√†o ƒë·ªÉ t·∫£i xu·ªëng!", "error");
          return;
        }

        let allContent = `${"‚ïê".repeat(60)}
üíï T·∫§T C·∫¢ TIN NH·∫ÆN T√åNH Y√äU üíï
${"‚ïê".repeat(60)}

T·ªïng s·ªë tin nh·∫Øn: ${messages.length}
Ng√†y t·∫°o file: ${new Date().toLocaleString("vi-VN")}

`;

        messages.forEach((msg, index) => {
          allContent += `
${"‚îÄ".repeat(50)}
TIN NH·∫ÆN ${index + 1}
${"‚îÄ".repeat(50)}

T·ª´: ${msg.from}
ƒê·∫øn: ${msg.to}
Ti√™u ƒë·ªÅ: ${msg.subject}
Ng√†y: ${msg.date}

${msg.message}

${msg.signature}

`;
        });

        allContent += `${"‚ïê".repeat(60)}
ƒê∆∞·ª£c t·∫°o t·ª´ Love Story Website
${new Date().toLocaleString("vi-VN")}
${"‚ïê".repeat(60)}`;

        downloadTextFile(allContent, "tat-ca-tin-nhan-tinh-yeu.txt");
        showStatus("üì• ƒê√£ t·∫£i xu·ªëng t·∫•t c·∫£ tin nh·∫Øn th√†nh c√¥ng!", "success");
      }

      // Create sparkle effect
      function createSparkleEffect(element) {
        for (let i = 0; i < 8; i++) {
          setTimeout(() => {
            const sparkle = document.createElement("div");
            sparkle.innerHTML = "‚ú®";
            sparkle.style.position = "fixed";
            sparkle.style.left =
              element.getBoundingClientRect().left +
              Math.random() * element.offsetWidth +
              "px";
            sparkle.style.top =
              element.getBoundingClientRect().top +
              Math.random() * element.offsetHeight +
              "px";
            sparkle.style.pointerEvents = "none";
            sparkle.style.fontSize = "20px";
            sparkle.style.zIndex = "9999";
            sparkle.style.animation = "sparkleFloat 2s ease-out forwards";

            document.body.appendChild(sparkle);

            setTimeout(() => {
              if (sparkle.parentNode) {
                sparkle.parentNode.removeChild(sparkle);
              }
            }, 2000);
          }, i * 100);
        }
      }

      // Add sparkle animation CSS
      const sparkleStyle = document.createElement("style");
      sparkleStyle.textContent = `
            @keyframes sparkleFloat {
                0% {
                    opacity: 1;
                    transform: translateY(0) scale(1);
                }
                100% {
                    opacity: 0;
                    transform: translateY(-100px) scale(0.5);
                }
            }
        `;
      document.head.appendChild(sparkleStyle);

      // Create new love letter on page
      function createNewLoveLetter(data) {
        const letterElement = document.createElement("div");
        letterElement.className = "love-letter";
        letterElement.style.opacity = "0";
        letterElement.style.transform = "translateY(30px)";
        letterElement.innerHTML = `
                <div class="letter-header">
                    <div class="letter-icon">üíå</div>
                    <div class="letter-info">
                        <h3>${data.subject}</h3>
                        <div class="letter-date">V·ª´a vi·∫øt - ${data.date}</div>
                    </div>
                </div>
                <div class="letter-content">
                    ${data.message.replace(/\n/g, "<br>")}
                </div>
                <div class="letter-signature">${data.signature}</div>
            `;

        // Insert before the form
        const form = document.querySelector(".message-form");
        form.parentNode.insertBefore(letterElement, form);

        // Animate in
        setTimeout(() => {
          letterElement.style.transition =
            "opacity 0.6s ease, transform 0.6s ease";
          letterElement.style.opacity = "1";
          letterElement.style.transform = "translateY(0)";
        }, 100);

        // Scroll to new letter
        setTimeout(() => {
          letterElement.scrollIntoView({ behavior: "smooth", block: "center" });
        }, 300);
      }

      // Form submission handler
      document
        .getElementById("messageForm")
        .addEventListener("submit", function (e) {
          e.preventDefault();

          const submitBtn = this.querySelector(".submit-btn");
          const btnText = submitBtn.querySelector(".btn-text");
          const loading = submitBtn.querySelector(".loading");

          // Show loading state
          submitBtn.disabled = true;
          btnText.style.opacity = "0";
          loading.classList.add("active");

          const formData = new FormData(this);

          // Get subject (handle custom subject)
          let subject = formData.get("subject");
          if (subject === "custom") {
            subject = formData.get("customSubject");
          }

          const messageData = {
            from: formData.get("from"),
            to: formData.get("to"),
            subject: subject,
            message: formData.get("message"),
            signature:
              formData.get("signature") ||
              `V·ªõi t√¨nh y√™u - ${formData.get("from")} ‚ù§Ô∏è`,
            date: new Date().toLocaleString("vi-VN"),
            timestamp: Date.now(),
          };

          // Simulate processing time
          setTimeout(() => {
            try {
              // Save message
              const allMessages = saveMessage(messageData);

              // Hide loading state
              submitBtn.disabled = false;
              btnText.style.opacity = "1";
              loading.classList.remove("active");

              // Show success message
              showStatus(
                "üíï Tin nh·∫Øn ƒë√£ ƒë∆∞·ª£c l∆∞u v√† t·∫£i xu·ªëng th√†nh c√¥ng! üíï",
                "success"
              );

              // Add sparkle effect
              createSparkleEffect(submitBtn);

              // Create new love letter on page
              createNewLoveLetter(messageData);

              // Reset form
              this.reset();
              document.getElementById("messageCounter").textContent = "0 k√Ω t·ª±";
              document.getElementById("customSubjectGroup").style.display =
                "none";
            } catch (error) {
              console.error("Error saving message:", error);

              // Hide loading state
              submitBtn.disabled = false;
              btnText.style.opacity = "1";
              loading.classList.remove("active");

              showStatus(
                "‚ùå C√≥ l·ªói x·∫£y ra khi l∆∞u tin nh·∫Øn. Vui l√≤ng th·ª≠ l·∫°i.",
                "error"
              );
            }
          }, 1500); // 1.5 second delay for effect
        });

      // Typing effect for quotes
      function typeEffect(element, text, speed = 50) {
        let i = 0;
        element.textContent = "";
        const timer = setInterval(() => {
          if (i < text.length) {
            element.textContent += text.charAt(i);
            i++;
          } else {
            clearInterval(timer);
          }
        }, speed);
      }

      // Apply typing effect to quotes when they come into view
      const observer = new IntersectionObserver((entries) => {
        entries.forEach((entry) => {
          if (entry.isIntersecting && !entry.target.dataset.typed) {
            const quoteText = entry.target.querySelector(".quote-text");
            if (quoteText) {
              const originalText = quoteText.textContent;
              typeEffect(quoteText, originalText, 30);
              entry.target.dataset.typed = "true";
            }
          }
        });
      });

      document.querySelectorAll(".quote-section").forEach((section) => {
        observer.observe(section);
      });

      // Add sparkles to special letters periodically
      setInterval(() => {
        const specialLetters = document.querySelectorAll(".special-letter");
        specialLetters.forEach((letter) => {
          if (Math.random() < 0.3) {
            // 30% chance
            addSparkles(letter);
          }
        });
      }, 3000);

      function addSparkles(element) {
        const sparkle = document.createElement("div");
        sparkle.innerHTML = "‚ú®";
        sparkle.style.position = "absolute";
        sparkle.style.left = Math.random() * 100 + "%";
        sparkle.style.top = Math.random() * 100 + "%";
        sparkle.style.pointerEvents = "none";
        sparkle.style.fontSize = "20px";
        sparkle.style.opacity = "0";
        sparkle.style.transition = "opacity 0.5s ease";

        element.style.position = "relative";
        element.appendChild(sparkle);

        setTimeout(() => {
          sparkle.style.opacity = "1";
        }, 100);

        setTimeout(() => {
          sparkle.style.opacity = "0";
          setTimeout(() => {
            if (sparkle.parentNode) {
              sparkle.parentNode.removeChild(sparkle);
            }
          }, 500);
        }, 2000);
      }

      // Memory card hover effects
      document.querySelectorAll(".memory-card").forEach((card) => {
        card.addEventListener("mouseenter", function () {
          this.style.transform = "translateY(-10px) scale(1.05)";
        });

        card.addEventListener("mouseleave", function () {
          this.style.transform = "translateY(0) scale(1)";
        });
      });

      // Auto-save drafts
      function saveDraft() {
        const formData = new FormData(document.getElementById("messageForm"));
        const draft = {};

        for (let [key, value] of formData.entries()) {
          draft[key] = value;
        }

        localStorage.setItem("messageDraft", JSON.stringify(draft));
      }

      function loadDraft() {
        const draft = localStorage.getItem("messageDraft");
        if (draft) {
          const data = JSON.parse(draft);
          const form = document.getElementById("messageForm");

          Object.keys(data).forEach((key) => {
            const input = form.querySelector(`[name="${key}"]`);
            if (input && data[key]) {
              input.value = data[key];

              // Handle custom subject
              if (key === "subject" && data[key] === "custom") {
                document.getElementById("customSubjectGroup").style.display =
                  "block";
                document.getElementById("customSubject").required = true;
              }

              // Update character counter
              if (key === "message") {
                document.getElementById(
                  "messageCounter"
                ).textContent = `${data[key].length} k√Ω t·ª±`;
              }
            }
          });
        }
      }

      // Load draft on page load
      document.addEventListener("DOMContentLoaded", function () {
        loadDraft();
      });

      // Save draft periodically
      setInterval(saveDraft, 30000); // Save every 30 seconds

      // Clear draft when form is submitted successfully
      document
        .getElementById("messageForm")
        .addEventListener("submit", function () {
          setTimeout(() => {
            localStorage.removeItem("messageDraft");
          }, 2000);
        });

      // Display message count
      function updateMessageCount() {
        const messages = JSON.parse(
          localStorage.getItem("loveMessages") || "[]"
        );
        const downloadBtn = document.querySelector(".download-btn");

        if (messages.length > 0) {
          downloadBtn.innerHTML = `üì• T·∫£i xu·ªëng t·∫•t c·∫£ tin nh·∫Øn (${messages.length})`;
        } else {
          downloadBtn.innerHTML = `üì• T·∫£i xu·ªëng t·∫•t c·∫£ tin nh·∫Øn`;
        }
      }

      // Update message count on page load
      document.addEventListener("DOMContentLoaded", updateMessageCount);
    </script>
  </body>
</html>
